algoliaBundle.$(function($){AlgoliaAnalytics.init({appId:algoliaConfig.applicationId,apiKey:algoliaConfig.instant.apiKey});getQueryParamFromCurrentUrl=function(queryParamName){var url=window.location.href;var regex=new RegExp('[?&]'+queryParamName+'(=([^&#]*)|&|#|$)');var results=regex.exec(url);if(!results||!results[2])return '';return results[2];}
trackAlgoliaConversion=function(el){var objectId=$(el).data('objectid')||getQueryParamFromCurrentUrl('objectID');var queryId=$(el).data('queryid')||getQueryParamFromCurrentUrl('queryID');var index=algoliaConfig.indexName+"_products"||getQueryParamFromCurrentUrl('index');if(objectId&&queryId){trackConversion(index,objectId,queryId);}}
$(algoliaConfig.autocomplete.selector).each(function(){$(this).on('autocomplete:selected',function(e,suggestion,dataset){var sources=analyticsHelper.sources;var source=sources.filter(function(src){return src.name==dataset;});if(source.length>0){var source=source[0];if(!source.indexName){source.index=algoliaConfig.indexName+"_products";}
trackClick(source.indexName,suggestion.objectID,suggestion.__position,suggestion.__queryID);}});});$(document).on('click',algoliaConfig.ccAnalytics.ISSelector,function(){var $this=$(this);var lastResults=analyticsHelper.getLastResults();if(lastResults){if(!lastResults.index){lastResults.index=algoliaConfig.indexName+"_products";}
trackClick(lastResults.index,$this.data('objectid'),$this.data('position'),$this.data('queryid'));}});if(algoliaConfig.ccAnalytics.conversionAnalyticsMode==='add_to_cart'){jQuery('#product-addtocart-button').click(function(){trackAlgoliaConversion(this);});}
if(algoliaConfig.ccAnalytics.conversionAnalyticsMode==='place_order'&&algoliaConfig.ccAnalytics.orderedProductIds.length>0){$.each(algoliaConfig.ccAnalytics.orderedProductIds,function(i,objectId){trackConversion(objectId);});}});var analyticsHelper={};algolia.registerHook('beforeInstantsearchStart',function(search){search.once('render',function(){analyticsHelper.getLastResults=function(){return search.helper.lastResults;}});return search;});algolia.registerHook('beforeInstantsearchInit',function(instantsearchOptions){instantsearchOptions.searchParameters['clickAnalytics']=true;return instantsearchOptions;});function trackClick(index,objectID,position,queryId){var clickData={index:"BrandAlleydefault_products",eventName:"Clicked item",objectIDs:[objectID.toString()],positions:[parseInt(position)],queryID:queryId};AlgoliaAnalytics.clickedObjectIDsAfterSearch(clickData);}
function trackConversion(index,objectID,queryId){AlgoliaAnalytics.convertedObjectIDsAfterSearch({index:"BrandAlleydefault_products",eventName:"Conversion",objectIDs:[objectID.toString()],queryID:queryId,});}